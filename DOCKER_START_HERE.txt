################################################################################
#                                                                              #
#   ğŸš€ DESPLIEGUE DOCKER - SISTEMA ERP                                         #
#                                                                              #
################################################################################

âœ… ESTADO: Sistema listo para dockerizar
ğŸ“… FECHA: Octubre 2025
ğŸ”§ VERSIÃ“N: 1.0.0

################################################################################
# ARCHIVOS PREPARADOS
################################################################################

âœ… docker-compose.yml              â†’ ConfiguraciÃ³n de servicios completa
âœ… Dockerfile                      â†’ Build multi-stage del frontend
âœ… nginx.conf                      â†’ Proxy reverso configurado
âœ… .env.production                 â†’ Variables de entorno listas

âœ… scripts/deploy-full-stack.ps1  â†’ Script de despliegue automatizado
âœ… scripts/build-backend.ps1      â†’ Script para construir backend
âœ… scripts/check-status.ps1       â†’ Script de verificaciÃ³n de estado

âœ… DOCKER_README.md                â†’ DocumentaciÃ³n completa
âœ… DOCKER_QUICK_START.md           â†’ GuÃ­a rÃ¡pida de uso
âœ… WINDOWS_SETUP_GUIDE.md          â†’ GuÃ­a de configuraciÃ³n Windows

################################################################################
# âš¡ INICIO RÃPIDO - 4 COMANDOS
################################################################################

1. Verificar que PostgreSQL estÃ© corriendo en Windows:

   Get-Service postgresql-x64-16

2. Si no estÃ¡ corriendo, iniciarlo:

   Start-Service postgresql-x64-16

3. Ejecutar despliegue Docker:

   cd c:\dev\erp-project\frontend
   docker-compose up -d

4. Acceder a la aplicaciÃ³n:

   http://localhost:8080
   
   Email:    admin
   Password: aDmin404942

################################################################################
# ğŸ”§ CONFIGURACIÃ“N DEL BACKEND
################################################################################

REQUISITO: El backend debe tener un Dockerfile en su directorio.

Estructura esperada del backend:
C:\dev\erp-project\backend\
  â”œâ”€â”€ Dockerfile        â† DEBE EXISTIR
  â”œâ”€â”€ .env (opcional)
  â””â”€â”€ ... (cÃ³digo fuente)

Si no tienes un Dockerfile en el backend, crÃ©alo siguiendo la estructura
de tu framework (Go, Node.js, Java, etc.)

################################################################################
# ğŸ“‹ PRE-REQUISITOS (VERIFICAR ANTES DE CONTINUAR)
################################################################################

[âœ“] Docker Desktop instalado y corriendo
[âœ“] PostgreSQL 16 corriendo en Windows (C:\Program Files\PostgreSQL\16\bin)
[âœ“] Base de datos 'erp_db' creada en PostgreSQL
[âœ“] Usuario 'dev_user' con permisos en la base de datos
[âœ“] PostgreSQL escuchando en todas las interfaces (listen_addresses = '*')
[âœ“] pg_hba.conf configurado para permitir conexiones desde Docker (172.17.0.0/16)
[âœ“] Backend ubicado en C:\dev\erp-project\backend
[âœ“] Backend tiene un Dockerfile y imagen construida (erp-backend:latest)
[âœ“] Frontend ubicado en C:\dev\erp-project\frontend

NOTA IMPORTANTE: PostgreSQL estÃ¡ instalado NATIVAMENTE en Windows
Ruta: C:\Program Files\PostgreSQL\16\bin
ConexiÃ³n desde Docker: host.docker.internal:5432

Para verificar PostgreSQL:
  Get-Service postgresql-x64-16
  Start-Service postgresql-x64-16

################################################################################
# ğŸš€ OPCIONES DE DESPLIEGUE
################################################################################

OPCIÃ“N 1: Despliegue RÃ¡pido (Recomendado)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  cd c:\dev\erp-project\frontend
  docker-compose up -d

  Esto levanta:
  - Backend (puerto 5050) â†’ conecta a PostgreSQL en Windows
  - Frontend (puerto 8080) â†’ sirve React app con Nginx


OPCIÃ“N 2: Despliegue con Rebuild
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  # Si cambiaste cÃ³digo del frontend
  cd c:\dev\erp-project\frontend
  docker-compose up -d --build

  # Si cambiaste cÃ³digo del backend
  cd c:\dev\erp-project\backend
  docker build -t erp-backend:latest .
  cd c:\dev\erp-project\frontend
  docker-compose up -d


OPCIÃ“N 3: Reconstruir todo desde cero
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  # Detener y limpiar
  cd c:\dev\erp-project\frontend
  docker-compose down
  
  # Reconstruir backend
  cd c:\dev\erp-project\backend
  docker build -t erp-backend:latest . --no-cache
  
  # Reconstruir y levantar frontend
  cd c:\dev\erp-project\frontend
  docker-compose up -d --build --force-recreate

################################################################################
# ğŸ” VERIFICACIÃ“N POST-DESPLIEGUE
################################################################################

Ejecuta el script de verificaciÃ³n:

  .\scripts\check-status.ps1

Verifica manualmente:

  1. Estado de contenedores:
     docker-compose ps
     
     DeberÃ­as ver:
     - erp-backend   (healthy)
     - erp-frontend  (healthy)

  2. Endpoints funcionando:
     - http://localhost:8080/           â†’ Frontend
     - http://localhost:5050/health     â†’ Backend directo
     - http://localhost:8080/api/health â†’ Backend vÃ­a proxy

  3. Login funcionando:
     - Abre http://localhost:8080
     - Login con admin / aDmin404942

################################################################################
# ğŸ“Š COMANDOS ÃšTILES
################################################################################

Ver logs en tiempo real:
  docker-compose logs -f

Ver logs de un servicio especÃ­fico:
  docker-compose logs -f backend
  docker-compose logs -f frontend

Ver estado de servicios:
  docker-compose ps

Reiniciar servicios:
  docker-compose restart

Detener servicios:
  docker-compose down

Reconstruir sin cache:
  docker-compose build --no-cache
  docker-compose up -d

################################################################################
# ğŸ› SOLUCIÃ“N DE PROBLEMAS
################################################################################

Problema: Backend no puede conectar a PostgreSQL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Verificar PostgreSQL estÃ¡ corriendo:
    Get-Service postgresql-x64-16
    
  Si no estÃ¡ corriendo:
    Start-Service postgresql-x64-16

  Verificar que escucha en todas las interfaces:
    # Editar C:\Program Files\PostgreSQL\16\data\postgresql.conf
    # Buscar: listen_addresses = '*'
    
  Verificar pg_hba.conf permite Docker:
    # Editar C:\Program Files\PostgreSQL\16\data\pg_hba.conf
    # Agregar: host all all 172.17.0.0/16 md5
    
  Reiniciar PostgreSQL:
    Restart-Service postgresql-x64-16

  Ver logs del backend:
    docker logs erp-backend --tail 50


Problema: Puerto ya en uso
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Encontrar proceso:
    netstat -ano | findstr :8080
    netstat -ano | findstr :5050

  Matar proceso:
    taskkill /PID <PID> /F


Problema: Imagen del backend no encontrada
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Construir manualmente:
    cd C:\dev\erp-project\backend
    docker build -t erp-backend:latest .

################################################################################
# ğŸ“š DOCUMENTACIÃ“N COMPLETA
################################################################################

Para mÃ¡s detalles, consulta:

  DOCKER_WINDOWS_POSTGRES_GUIDE.md  â†’ GuÃ­a PostgreSQL en Windows (NUEVO)
  DOCKER_README.md                  â†’ DocumentaciÃ³n completa
  DOCKER_QUICK_START.md             â†’ GuÃ­a rÃ¡pida
  WINDOWS_SETUP_GUIDE.md            â†’ ConfiguraciÃ³n Windows completa
  DOCKER_WSL_GUIDE.md               â†’ (OBSOLETO - para PostgreSQL en WSL)

################################################################################
# ğŸ¯ PRÃ“XIMOS PASOS
################################################################################

1. AsegÃºrate de que PostgreSQL estÃ© corriendo
2. Verifica que el backend tenga un Dockerfile
3. Ejecuta: .\scripts\deploy-full-stack.ps1
4. Accede a: http://localhost:8080

################################################################################
# ğŸ†˜ NECESITAS AYUDA?
################################################################################

1. Revisa la documentaciÃ³n en DOCKER_README.md
2. Ejecuta el script de verificaciÃ³n: .\scripts\check-status.ps1
3. Revisa los logs: docker-compose logs -f

################################################################################

âœ¨ Â¡El sistema estÃ¡ listo para ser dockerizado!

Ejecuta el script de despliegue para comenzar:

  .\scripts\deploy-full-stack.ps1

################################################################################
