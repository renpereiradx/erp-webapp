// Simple i18n utility (extensible)
// Usage: const { t, lang, setLang } = useI18n(); t('products.title')
import { useState, useCallback } from 'react';

const DICTIONARY = {
  es: {
    'products.title': 'Gestión de Productos',
    'products.new': 'Nuevo Producto',
    'products.loading': 'Cargando productos...',
    'products.error.loading': 'Error al cargar',
    'products.retry': 'Reintentar',
    'products.search.db': 'Buscar en Base de Datos',
    'products.search.placeholder': 'Buscar por nombre o ID...',
    'products.search': 'Buscar',
    'products.clear': 'Limpiar',
    'products.bulk.activate': 'Activar',
    'products.bulk.deactivate': 'Desactivar',
    'products.bulk.clear': 'Limpiar',
    'products.inline.save': 'Guardar',
    'products.inline.cancel': 'Cancelar',
    'products.create_first': 'Crear Primer Producto',
    'products.no_products_loaded': 'No hay productos cargados',
    'products.no_results': 'No se encontraron productos',
    'products.no_results_for': 'No hay productos que coincidan con "{term}"',
    'products.search.help1': 'Puedes buscar por nombre (ej: "Puma") o por ID completo (ej: "bcYdWdKNR")',
    'products.search.help2': 'Búsqueda automática: mínimo {minChars} caracteres. Atajo: "/" para enfocar.',
    'products.page_size_label': 'Productos por página:',
    'validation.required': 'Requerido',
    'validation.price.invalid': 'Precio inválido',
    'validation.price.invalid.short': 'Inválido',
    'validation.stock.invalid': 'Stock inválido',
    'validation.stock.invalid.short': 'Inválido',
    'field.name': 'Nombre',
    'field.price': 'Precio',
    'field.unit_price': 'Precio/Unidad:',
    'field.stock': 'Stock',
    'field.no_name': 'Sin nombre',
    'field.code': 'Código',
    'field.id': 'ID',
    'field.category': 'Categoría',
    'action.view': 'Ver',
    'action.edit': 'Editar',
    'action.inline': 'Inline',
    'action.delete_product': 'Eliminar producto',
    'badge.low_stock': 'Bajo stock',
    'badge.low_stock.upper': 'BAJO STOCK',

    // Error hints
    'errors.hint.INTERNAL': 'Problema interno, intenta más tarde.',
    'errors.hint.NETWORK': 'Verifica tu conexión a internet.',
    'errors.hint.UNAUTHORIZED': 'Reinicia sesión para continuar.',
    'errors.hint.NOT_FOUND': 'El recurso no existe o fue eliminado.',
    'errors.hint.VALIDATION': 'Revisa los datos ingresados.',
    'errors.hint.RATE_LIMIT': 'Demasiadas solicitudes, espera e intenta de nuevo.',
    'errors.hint.CONFLICT': 'Conflicto de estado, refresca los datos.',
    'errors.hint.UNKNOWN': 'Ocurrió un error inesperado.',

    'errors.toast.copy_code': 'Copiar código',
    'errors.toast.retry': 'Reintentar',
    'errors.toast.diagnostics': 'Diagnóstico',

    // Añadir keys adicionales para modales
    'products.edit_title': 'Editar Producto',
    'products.new_title': 'Nuevo Producto',
    'products.name_placeholder': 'Ingrese el nombre del producto',
    'products.description_label': 'Descripción',
    'products.description_placeholder': 'Descripción detallada del producto...',
    'products.category_label': 'Categoría *',
    'products.categories_loading': 'Cargando categorías...',
    'products.categories_error': 'Error al cargar categorías',
    'products.categories_none': 'No hay categorías disponibles',
    'products.categories_select': 'Seleccionar categoría...',
    'products.type_label': 'Tipo de Producto',
    'products.active_label': 'Producto Activo',
    'products.cancel': 'Cancelar',
    'products.saving': 'Guardando...',
    'products.categories_first': 'Cargar categorías primero',
    'products.save': 'Guardar',
    'products.name_placeholder': 'Ingrese el nombre del producto',

    'products.delete_title': 'Eliminar Producto',
    'products.delete_subtitle': 'Esta acción no se puede deshacer',
    'products.id_label': 'ID Producto',
    'products.info_title': 'Información Importante',
    'products.delete_hint.soft': 'El producto será marcado como eliminado (soft delete)',
    'products.deleting': 'Eliminando...',
    'products.delete_action': 'Eliminar',

    // Claves adicionales para ProductDetailModal
    'products.no_description': 'Sin descripción disponible',
    'products.error.load_details': 'Error al cargar detalles del producto',
    'products.description_updated': 'Descripción actualizada exitosamente',
    'products.error.save_description': 'Error al guardar descripción',
    'products.prices_updated': 'Precios actualizados exitosamente',
    'products.error.save_price': 'Error al guardar precio',
    'products.stock_updated': 'Stock actualizado exitosamente',
    'products.error.save_stock': 'Error al guardar stock',
    'products.id_label': 'ID',
    'products.tabs.info': 'Información',
    'products.tabs.description': 'Descripción',
    'products.tabs.price': 'Precios',
    'products.tabs.stock': 'Stock',
    'products.info_general': 'Información General',
    'products.description_info': 'Información de Descripción',
    'products.description_heading': 'Descripción del Producto',
    'products.price_info': 'Información de Precios',
    'products.configure_prices': 'Configurar Precios',
    'products.stock_info': 'Información de Stock',
    'products.configure_stock': 'Configurar Inventario',
    'products.enriched_title': 'Producto con datos enriquecidos',
    'products.unit_pricing_title': 'Producto con precios por unidad (kg, caja, etc.)',
    'products.multiple_units_title': 'Múltiples unidades disponibles',
    'products.list_label': 'Listado de productos',
    'products.item_aria': 'Producto {nameOrId}',

    // Announcements
    'announce.error_validation': 'Error de validación: {msg}',
    'announce.error_network': 'Error de red: {msg}',
    'announce.results_for': 'Resultados: {total} para "{term}"',
    'announce.total_results': 'Total resultados: {total}',

    'errors.code_label': 'Código: {code}',
    'errors.hint.label': 'Sugerencia',
  },
  en: {
    'products.title': 'Product Management',
    'products.new': 'New Product',
    'products.loading': 'Loading products...',
    'products.error.loading': 'Load error',
    'products.retry': 'Retry',
    'products.search.db': 'Search in Database',
    'products.search.placeholder': 'Search by name or ID...',
    'products.search': 'Search',
    'products.clear': 'Clear',
    'products.bulk.activate': 'Activate',
    'products.bulk.deactivate': 'Deactivate',
    'products.bulk.clear': 'Clear',
    'products.inline.save': 'Save',
    'products.inline.cancel': 'Cancel',
    'products.create_first': 'Create First Product',
    'products.no_products_loaded': 'No products loaded',
    'products.no_results': 'No products found',
    'products.no_results_for': 'No products matched "{term}"',
    'products.search.help1': 'You can search by name (e.g. "Puma") or by full ID (e.g. "bcYdWdKNR")',
    'products.search.help2': 'Auto-search: minimum {minChars} characters. Shortcut: "/" to focus.',
    'products.page_size_label': 'Products per page:',
    'validation.required': 'Required',
    'validation.price.invalid': 'Invalid price',
    'validation.price.invalid.short': 'Invalid',
    'validation.stock.invalid': 'Invalid stock',
    'validation.stock.invalid.short': 'Invalid',
    'field.name': 'Name',
    'field.price': 'Price',
    'field.unit_price': 'Unit Price:',
    'field.stock': 'Stock',
    'field.no_name': 'No name',
    'field.code': 'Code',
    'field.id': 'ID',
    'field.category': 'Category',
    'action.view': 'View',
    'action.edit': 'Edit',
    'action.inline': 'Inline',
    'action.delete_product': 'Delete product',
    'badge.low_stock': 'Low stock',
    'badge.low_stock.upper': 'LOW STOCK',

    // Error hints
    'errors.hint.INTERNAL': 'Internal server issue, try again later.',
    'errors.hint.NETWORK': 'Check your internet connection.',
    'errors.hint.UNAUTHORIZED': 'Please sign in again to continue.',
    'errors.hint.NOT_FOUND': 'The resource does not exist or was removed.',
    'errors.hint.VALIDATION': 'Check the entered data.',
    'errors.hint.RATE_LIMIT': 'Too many requests, wait and retry.',
    'errors.hint.CONFLICT': 'State conflict, refresh the data.',
    'errors.hint.UNKNOWN': 'An unexpected error occurred.',

    'errors.toast.copy_code': 'Copy code',
    'errors.toast.retry': 'Retry',
    'errors.toast.diagnostics': 'Diagnostics',

    'products.edit_title': 'Edit Product',
    'products.new_title': 'New Product',
    'products.name_placeholder': 'Enter product name',
    'products.description_label': 'Description',
    'products.description_placeholder': 'Detailed product description...',
    'products.category_label': 'Category *',
    'products.categories_loading': 'Loading categories...',
    'products.categories_error': 'Error loading categories',
    'products.categories_none': 'No categories available',
    'products.categories_select': 'Select category...',
    'products.type_label': 'Product type',
    'products.active_label': 'Product active',
    'products.cancel': 'Cancel',
    'products.saving': 'Saving...',
    'products.categories_first': 'Load categories first',
    'products.save': 'Save',
    'products.name_placeholder': 'Enter product name',

    'products.delete_title': 'Delete Product',
    'products.delete_subtitle': 'This action cannot be undone',
    'products.id_label': 'Product ID',
    'products.info_title': 'Important information',
    'products.delete_hint.soft': 'The product will be marked as deleted (soft delete)',
    'products.deleting': 'Deleting...',
    'products.delete_action': 'Delete',

    // EN
    'products.no_description': 'No description available',
    'products.error.load_details': 'Error loading product details',
    'products.description_updated': 'Description updated successfully',
    'products.error.save_description': 'Error saving description',
    'products.prices_updated': 'Prices updated successfully',
    'products.error.save_price': 'Error saving price',
    'products.stock_updated': 'Stock updated successfully',
    'products.error.save_stock': 'Error saving stock',
    'products.id_label': 'ID',
    'products.tabs.info': 'Information',
    'products.tabs.description': 'Description',
    'products.tabs.price': 'Prices',
    'products.tabs.stock': 'Stock',
    'products.info_general': 'General Information',
    'products.description_info': 'Description Information',
    'products.description_heading': 'Product Description',
    'products.price_info': 'Price Information',
    'products.configure_prices': 'Configure Prices',
    'products.stock_info': 'Stock Information',
    'products.configure_stock': 'Configure Inventory',
    'products.enriched_title': 'Product with enriched data',
    'products.unit_pricing_title': 'Product with unit pricing (kg, box, etc.)',
    'products.multiple_units_title': 'Multiple units available',
    'products.list_label': 'Product list',
    'products.item_aria': 'Product {nameOrId}',

    // Announcements
    'announce.error_validation': 'Validation error: {msg}',
    'announce.error_network': 'Network error: {msg}',
    'announce.results_for': 'Results: {total} for "{term}"',
    'announce.total_results': 'Total results: {total}',

    'errors.code_label': 'Error code: {code}',
    'errors.hint.label': 'Hint',
  }
};

// Add additional product-level messages and banners
// (kept after DICTIONARY to avoid large duplicate blocks)
Object.assign(DICTIONARY.es, {
  'products.offline_banner': 'Estás sin conexión. Los datos pueden estar desactualizados.',
  'products.auto_login_success': 'Auto-login exitoso! Recargando categorías...',
  'products.auto_login_error': 'Error en auto-login',
  'products.operation_success': 'Operación completada exitosamente',
  'products.deleted_success': 'Producto "{name}" eliminado exitosamente',
  'products.updated_notice': 'Producto {id} actualizado',
  'products.subtitle': 'Administra tu inventario con la Business Management API',
  'products.filter.current_results_title': 'Filtrar Resultados Actuales',
  'products.filter.name_placeholder': 'Filtrar por nombre...',
  'products.filter.all_categories': 'Todas las categorías',
  'products.filter.all_status': 'Todos los estados',
  'products.filter.status.active': 'Activos',
  'products.filter.status.inactive': 'Inactivos',
  'products.filter.products_label': 'Productos',
  'products.bulk.selected_count': '{count} seleccionados',
  'products.pagination.showing_page_count': 'Mostrando {shown} de {pageCount} productos en esta página',
  'products.pagination.search_prefix': 'Búsqueda:',
  'products.pagination.by_id': 'por ID',
  'products.pagination.by_name': 'por nombre',
  'products.pagination.total_found': 'Total encontrados: {total}',
  'products.pagination.first': 'Primera',
  'products.pagination.prev': 'Anterior',
  'products.pagination.next': 'Siguiente',
  'products.pagination.last': 'Última',
  'products.pagination.page_of': 'Página {page} de {totalPages}',
});
Object.assign(DICTIONARY.en, {
  'products.offline_banner': 'You are offline. Data may be stale.',
  'products.auto_login_success': 'Auto-login successful! Reloading categories...',
  'products.auto_login_error': 'Auto-login error',
  'products.operation_success': 'Operation completed successfully',
  'products.deleted_success': 'Product "{name}" deleted successfully',
  'products.updated_notice': 'Product {id} updated',
  'products.subtitle': 'Manage your inventory with the Business Management API',
  'products.filter.current_results_title': 'Filter Current Results',
  'products.filter.name_placeholder': 'Filter by name...',
  'products.filter.all_categories': 'All categories',
  'products.filter.all_status': 'All statuses',
  'products.filter.status.active': 'Active',
  'products.filter.status.inactive': 'Inactive',
  'products.filter.products_label': 'Products',
  'products.bulk.selected_count': '{count} selected',
  'products.pagination.showing_page_count': 'Showing {shown} of {pageCount} products on this page',
  'products.pagination.search_prefix': 'Search:',
  'products.pagination.by_id': 'by ID',
  'products.pagination.by_name': 'by name',
  'products.pagination.total_found': 'Total found: {total}',
  'products.pagination.first': 'First',
  'products.pagination.prev': 'Previous',
  'products.pagination.next': 'Next',
  'products.pagination.last': 'Last',
  'products.pagination.page_of': 'Page {page} of {totalPages}',
});

let currentLang = 'es';
export const setI18nLang = (l) => { if (DICTIONARY[l]) currentLang = l; };
export const tRaw = (key) => (DICTIONARY[currentLang] && DICTIONARY[currentLang][key]) || key;

export function useI18n() {
  const [lang, setLangState] = useState(currentLang);
  const setLang = useCallback((l) => { if (DICTIONARY[l]) { currentLang = l; setLangState(l); } }, []);
  // soporta interpolación simple: t('key', { a: 1 }) -> reemplaza {a}
  const t = useCallback((key, vars) => {
    const template = (DICTIONARY[lang] && DICTIONARY[lang][key]) || key;
    if (!vars) return template;
    return String(template).replace(/\{(\w+)\}/g, (_, k) => (Object.prototype.hasOwnProperty.call(vars, k) ? String(vars[k]) : `{${k}}`));
  }, [lang]);
  return { t, lang, setLang };
}
