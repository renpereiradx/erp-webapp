# ğŸ—ï¸ Arquitectura de Deployment - Diagrama Visual

## ğŸ“Š Vista General de la Arquitectura

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DEPLOYMENT ARCHITECTURE                     â”‚
â”‚                              ERP Web App                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DESARROLLO LOCAL                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚ Browser  â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚        â”‚ http://localhost:5173                                       â”‚
â”‚        â†“                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚   Vite Dev Server    â”‚                                          â”‚
â”‚   â”‚      (port 5173)     â”‚                                          â”‚
â”‚   â”‚  - Hot Module Reload â”‚                                          â”‚
â”‚   â”‚  - Source Maps       â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚              â”‚                                                         â”‚
â”‚              â”‚ API Calls                                              â”‚
â”‚              â”‚ VITE_API_URL=http://localhost:5050                   â”‚
â”‚              â†“                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚  Backend Go Server  â”‚â”€â”€â”€â”€â”€â–¶â”‚   PostgreSQL     â”‚                â”‚
â”‚   â”‚    (port 5050)      â”‚      â”‚   (port 5432)    â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                       â”‚
â”‚   Variables clave:                                                   â”‚
â”‚   â€¢ VITE_API_URL=http://localhost:5050                              â”‚
â”‚   â€¢ VITE_AUTO_LOGIN=true                                            â”‚
â”‚   â€¢ VITE_ENV=development                                            â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRODUCCIÃ“N DOCKER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚  Client  â”‚                                                       â”‚
â”‚   â”‚ (Browser)â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚        â”‚ http://app.com                                              â”‚
â”‚        â†“                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              NGINX (Port 80)                                  â”‚  â”‚
â”‚   â”‚              Container: business_management_frontend          â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚                            â”‚                                  â”‚  â”‚
â”‚   â”‚  location /               â”‚    location /api/                â”‚  â”‚
â”‚   â”‚  â”œâ”€ try_files             â”‚    â”œâ”€ rewrite ^/api/(.*)$ /$1   â”‚  â”‚
â”‚   â”‚  â””â”€ Serve static files    â”‚    â””â”€ proxy_pass backend:5050   â”‚  â”‚
â”‚   â”‚     from /usr/share/      â”‚                                  â”‚  â”‚
â”‚   â”‚     nginx/html            â”‚                                  â”‚  â”‚
â”‚   â”‚                            â”‚                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                â”‚                         â”‚
â”‚            â†“                                â†“                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  Static Files    â”‚            â”‚   Backend Go Server â”‚           â”‚
â”‚   â”‚  (React SPA)     â”‚            â”‚   Container:        â”‚           â”‚
â”‚   â”‚  - index.html    â”‚            â”‚   business_mgmt_    â”‚           â”‚
â”‚   â”‚  - *.js          â”‚            â”‚   backend           â”‚           â”‚
â”‚   â”‚  - *.css         â”‚            â”‚   (port 5050)       â”‚           â”‚
â”‚   â”‚  - assets/       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚                       â”‚
â”‚                                              â†“                        â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                    â”‚   PostgreSQL        â”‚           â”‚
â”‚                                    â”‚   (host.docker.     â”‚           â”‚
â”‚                                    â”‚    internal:5432)   â”‚           â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                       â”‚
â”‚   Variables clave:                                                   â”‚
â”‚   â€¢ VITE_API_URL=/api (proxy interno)                               â”‚
â”‚   â€¢ VITE_AUTO_LOGIN=false                                           â”‚
â”‚   â€¢ VITE_ENV=production                                             â”‚
â”‚                                                                       â”‚
â”‚   Red Docker: erp-network (bridge)                                  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Requests

### Request 1: Archivos EstÃ¡ticos (HTML, JS, CSS)

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     GET /              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     read file    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Nginx   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  /usr/   â”‚
â”‚         â”‚                         â”‚  :80     â”‚                  â”‚  share/  â”‚
â”‚         â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  nginx/  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    200 OK (index.html)  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    index.html    â”‚  html/   â”‚
                                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Proceso:
1. Cliente solicita http://app.com/
2. Nginx busca archivo en /usr/share/nginx/html/
3. Encuentra index.html
4. Lo sirve al cliente con status 200
```

### Request 2: API Request (via Proxy)

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   POST /api/login     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   rewrite to     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Nginx   â”‚   POST /login    â”‚ Backend  â”‚
â”‚         â”‚                        â”‚  :80     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  :5050   â”‚
â”‚         â”‚                        â”‚          â”‚                  â”‚          â”‚
â”‚         â”‚                        â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚         â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚  JSON Response   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   200 OK + JSON        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               (proxy_pass)

Proceso:
1. Cliente hace fetch('/api/login', {...})
2. Request llega a Nginx en puerto 80
3. Nginx detecta location /api/
4. Reescribe: /api/login â†’ /login
5. Hace proxy_pass a http://backend:5050/login
6. Backend procesa y responde
7. Nginx devuelve la respuesta al cliente
```

### Request 3: React Router Navigation

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   GET /products       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   try_files      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Nginx   â”‚   $uri not found â”‚  Return  â”‚
â”‚         â”‚                        â”‚  :80     â”‚   $uri/ not      â”‚  index.  â”‚
â”‚         â”‚                        â”‚          â”‚   found          â”‚  html    â”‚
â”‚         â”‚                        â”‚          â”‚   /index.html âœ“  â”‚          â”‚
â”‚         â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   200 OK (index.html)  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               React Router
               handles /products

Proceso:
1. Usuario navega a /products
2. Nginx busca archivo /products (no existe)
3. Nginx busca carpeta /products/ (no existe)
4. Nginx sirve /index.html (fallback para SPA)
5. React Router toma control y renderiza la pÃ¡gina Products
```

---

## ğŸ­ Build Process

### Multi-Stage Dockerfile

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STAGE 1: BUILDER                               â”‚
â”‚                      Image: node:20-alpine                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. WORKDIR /app                                                     â”‚
â”‚  2. COPY package*.json pnpm-lock.yaml                                â”‚
â”‚  3. RUN npm install -g pnpm                                          â”‚
â”‚  4. RUN pnpm install                                                 â”‚
â”‚  5. COPY . .                                                         â”‚
â”‚  6. RUN pnpm build                                                   â”‚
â”‚                                                                       â”‚
â”‚  Output: /app/dist/                                                  â”‚
â”‚  â”œâ”€â”€ index.html                                                      â”‚
â”‚  â”œâ”€â”€ assets/                                                         â”‚
â”‚  â”‚   â”œâ”€â”€ index-[hash].js                                            â”‚
â”‚  â”‚   â”œâ”€â”€ index-[hash].css                                           â”‚
â”‚  â”‚   â””â”€â”€ [images, fonts, etc.]                                      â”‚
â”‚  â””â”€â”€ [other static files]                                           â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    Files copied to Stage 2
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STAGE 2: PRODUCTION                               â”‚
â”‚                   Image: nginx:stable-alpine                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. COPY --from=builder /app/dist /usr/share/nginx/html             â”‚
â”‚  2. COPY nginx.conf /etc/nginx/conf.d/default.conf                  â”‚
â”‚  3. EXPOSE 80                                                        â”‚
â”‚  4. CMD ["nginx", "-g", "daemon off;"]                              â”‚
â”‚                                                                       â”‚
â”‚  Final Image:                                                        â”‚
â”‚  â”œâ”€â”€ Nginx server (stable-alpine)                                   â”‚
â”‚  â”œâ”€â”€ Static files in /usr/share/nginx/html/                         â”‚
â”‚  â”œâ”€â”€ Proxy configuration in /etc/nginx/conf.d/                      â”‚
â”‚  â””â”€â”€ Port 80 exposed                                                 â”‚
â”‚                                                                       â”‚
â”‚  Image Size: ~50-60 MB (vs ~1GB with Node.js included)             â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Network Architecture (Docker)

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Docker Network: erp-network                     â”‚
â”‚                            (Bridge Driver)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Container: business_management_frontend                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Hostname: frontend                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Internal IP: 172.18.0.2 (example)                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Ports: 80:80                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Image: erp-frontend:latest                              â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†•                                        â”‚
â”‚                    Can communicate via                                â”‚
â”‚                    hostname: backend                                  â”‚
â”‚                              â†•                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Container: business_management_backend                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Hostname: backend                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Internal IP: 172.18.0.3 (example)                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Ports: 5050:5050                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Image: business-management-backend:latest               â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†•                                        â”‚
â”‚                    Connects to PostgreSQL                             â”‚
â”‚                    via host.docker.internal                           â”‚
â”‚                              â†•                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Host Machine: PostgreSQL                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Address: host.docker.internal:5432                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Database: business_management_prod                      â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Port Mapping:                                                       â”‚
â”‚  â€¢ Host:80 â†’ frontend:80 (public web access)                        â”‚
â”‚  â€¢ Host:5050 â†’ backend:5050 (direct backend access, optional)       â”‚
â”‚  â€¢ Host:5432 â†’ PostgreSQL (not exposed to Docker network)           â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Access:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Internet â”‚
â”‚  Users   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ http://app.com (or http://localhost)
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Host:80   â”‚ â† Mapped to frontend container port 80
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Flow

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AUTHENTICATION FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. User Login                                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   POST /api/auth/login   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚     â”‚ Browser â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Nginx  â”‚               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   {email, password}        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
â”‚                                                  â”‚                    â”‚
â”‚                                                  â”‚ proxy to           â”‚
â”‚                                                  â”‚ backend:5050       â”‚
â”‚                                                  â†“                    â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                                            â”‚ Backend  â”‚               â”‚
â”‚                                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                 â”‚                     â”‚
â”‚  2. Backend validates credentials              â”‚                     â”‚
â”‚     â”œâ”€ Check user exists                       â”‚                     â”‚
â”‚     â”œâ”€ Verify password hash                    â”‚                     â”‚
â”‚     â””â”€ Generate JWT token                      â”‚                     â”‚
â”‚                                                 â”‚                     â”‚
â”‚  3. Response with JWT                          â”‚                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚     â”‚ Browser â”‚   {token: "eyJ...", user: {...}}                     â”‚
â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                       â”‚
â”‚          â”‚                                                             â”‚
â”‚  4. Store token in localStorage                                      â”‚
â”‚     â””â”€ localStorage.setItem('token', token)                          â”‚
â”‚                                                                       â”‚
â”‚  5. Subsequent API requests                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   GET /api/products          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚ Browser â”‚   Authorization: Bearer eyJ..  â”‚  Nginx  â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚
â”‚                                                     â”‚                 â”‚
â”‚                                                     â”‚ proxy           â”‚
â”‚                                                     â†“                 â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                                              â”‚ Backend  â”‚             â”‚
â”‚                                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                   â”‚                   â”‚
â”‚  6. Backend validates JWT                        â”‚                   â”‚
â”‚     â”œâ”€ Verify signature                          â”‚                   â”‚
â”‚     â”œâ”€ Check expiration                          â”‚                   â”‚
â”‚     â”œâ”€ Extract user info                         â”‚                   â”‚
â”‚     â””â”€ Process request                           â”‚                   â”‚
â”‚                                                   â”‚                   â”‚
â”‚  7. Return data                                  â”‚                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚     â”‚ Browser â”‚   {products: [...]}                                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Notes:
â€¢ VITE_AUTO_LOGIN=false in production (no test credentials)
â€¢ JWT stored in localStorage (accessible to JS)
â€¢ Token included in all API requests via Authorization header
â€¢ Backend validates token on every protected endpoint
```

---

## ğŸ“¦ File Structure in Production

```text
Docker Container: business_management_frontend
â””â”€â”€ /
    â”œâ”€â”€ etc/
    â”‚   â””â”€â”€ nginx/
    â”‚       â””â”€â”€ conf.d/
    â”‚           â””â”€â”€ default.conf          â† Nginx configuration
    â”‚
    â””â”€â”€ usr/
        â””â”€â”€ share/
            â””â”€â”€ nginx/
                â””â”€â”€ html/                  â† Root directory for static files
                    â”œâ”€â”€ index.html         â† Main HTML file
                    â”œâ”€â”€ favicon.ico
                    â””â”€â”€ assets/
                        â”œâ”€â”€ index-[hash].js     â† Bundled JavaScript
                        â”œâ”€â”€ index-[hash].css    â† Bundled CSS
                        â””â”€â”€ [images, fonts]     â† Static assets

Process:
1. Request comes to Nginx on port 80
2. location / matches the request
3. try_files checks:
   - $uri: /usr/share/nginx/html/ + requested path
   - $uri/: same but as directory
   - /index.html: fallback for SPA routing
4. File is served or index.html for client-side routing
```

---

## ğŸ”„ Environment Variable Injection

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BUILD TIME vs RUNTIME                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€ BUILD TIME (pnpm build) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  1. Read .env.production file                                 â”‚   â”‚
â”‚  â”‚     VITE_API_URL=/api                                         â”‚   â”‚
â”‚  â”‚     VITE_AUTO_LOGIN=false                                     â”‚   â”‚
â”‚  â”‚     VITE_ENV=production                                       â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  2. Vite processes src/config/api.config.js:                 â”‚   â”‚
â”‚  â”‚     export const API_BASE_URL =                               â”‚   â”‚
â”‚  â”‚       import.meta.env.VITE_API_URL || 'http://localhost:5050'â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  3. Vite replaces import.meta.env.VITE_API_URL with "/api"  â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  4. Output in dist/assets/index-[hash].js:                   â”‚   â”‚
â”‚  â”‚     const API_BASE_URL = "/api";  â† Hardcoded!               â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                        â”‚
â”‚                    Variables are BAKED IN                             â”‚
â”‚                              â†“                                        â”‚
â”‚  â”Œâ”€ RUNTIME (Nginx serving files) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  â€¢ Browser loads index-[hash].js                              â”‚   â”‚
â”‚  â”‚  â€¢ API_BASE_URL is already "/api" (can't change)             â”‚   â”‚
â”‚  â”‚  â€¢ Any fetch() calls use this hardcoded value                â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  To change configuration:                                     â”‚   â”‚
â”‚  â”‚  1. Update .env.production                                    â”‚   â”‚
â”‚  â”‚  2. Rebuild: pnpm build                                       â”‚   â”‚
â”‚  â”‚  3. Rebuild Docker: docker-compose build frontend            â”‚   â”‚
â”‚  â”‚  4. Restart: docker-compose up -d frontend                   â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  IMPORTANT:                                                          â”‚
â”‚  â€¢ Environment variables are NOT runtime-configurable              â”‚
â”‚  â€¢ They are replaced at BUILD time by Vite                         â”‚
â”‚  â€¢ Changing .env without rebuild has NO effect                     â”‚
â”‚  â€¢ Use build-and-deploy.sh for proper rebuild workflow            â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Documento creado:** Diciembre 2024  
**Ãšltima actualizaciÃ³n:** Diciembre 2024  
**VersiÃ³n:** 1.0.0
